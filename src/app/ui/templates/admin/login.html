{% extends 'base.html' %}
{% block content %}
<section style="max-width:420px;margin:2rem auto;">
  <h2 style="margin-top:0;">Вход</h2>
  <p class="muted" style="margin-bottom:1rem;">Авторизуйтесь для доступа к панели.</p>
  <form id="loginForm" class="card" style="display:flex;flex-direction:column;gap:.75rem;">
    <label>
      <span>Email</span>
      <input name="username" type="email" required style="width:100%;padding:.55rem;border:1px solid var(--border);border-radius:6px;">
    </label>
    <label>
      <span>Пароль</span>
      <input name="password" type="password" required style="width:100%;padding:.55rem;border:1px solid var(--border);border-radius:6px;">
    </label>
    <button class="btn" type="submit">Войти</button>
    <div id="loginError" class="muted" style="display:none;color:#dc2626;"></div>
  </form>
</section>
<script>
document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const form = e.target;
  const fd = new FormData(form);
  try {
    const res = await fetch('/auth/token', { method:'POST', body: fd });
    if(!res.ok){
      document.getElementById('loginError').style.display='block';
      document.getElementById('loginError').textContent='Неверные данные';
      return;
    }
    const data = await res.json();
    localStorage.setItem('access_token', data.access_token);
    window.location.href='/admin/';
  } catch(err){
    document.getElementById('loginError').style.display='block';
    document.getElementById('loginError').textContent='Ошибка подключения';
  }
});
</script>
{% endblock %}